#include <math.h>
#include "my_ekf.h"
float kalman(float mx, float my, float mz, float gz){
  float mx_adj = 1.0153228991248186563467470477917*mx - 0.095132327150975637408691909513436*my - 0.0064141916098962858949761312032933*mz + 1.6936848194382059089241373715054;
  float my_adj = 0.98206066057741192576457933682832*my - 0.095132327150975637408691909513436*mx + 0.070975319801696024057946488028392*mz + 4.8348718950622636203014774094551;
  float mz_adj = 0.070975319801696024057946488028392*my - 0.0064141916098962858949761312032933*mx + 1.0172155326496177263351228248212*mz + 0.11239152879840373826130887178033;
  float m = atan2(mx_adj, my_adj);
  static float xhat = m;
  float y = xhat; // yhat(k) = xhat(k)
  xhat = 0.01*gz + 0.6180339887498949025257388711907*m + 0.3819660112501050974742611288093*xhat; // xhat(k+1) = G*gz+F*L*(m-C*xhat(k))+F*xhat(k)
}